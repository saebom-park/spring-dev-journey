# 06-auth-security-all-in-one
Spring Security í•™ìŠµ ê³¼ì •(SEC-1 ~ SEC-5)ì„ í•˜ë‚˜ì˜ í”„ë¡œì íŠ¸ì—ì„œ í†µí•©í•´ êµ¬í˜„í•˜ëŠ” ë³µìŠµ ë‹¨ê³„ìž…ë‹ˆë‹¤.  
ì„¸ì…˜ ë¡œê·¸ì¸ â†’ JWT ì¸ì¦ â†’ í•„í„° ì²´ì¸ â†’ ê¶Œí•œ ì œì–´ â†’ ë¹„ë°€ë²ˆí˜¸ ì•”í˜¸í™”ê¹Œì§€ ì „ì²´ íë¦„ì„ ì‹¤ì „ í˜•íƒœë¡œ ë‹¤ì‹œ êµ¬ì„±í•©ë‹ˆë‹¤.

---

## ðŸ—‚ï¸ í•™ìŠµ ì‹œë‚˜ë¦¬ì˜¤

1. íšŒì›ê°€ìž… ì‹œ ë¹„ë°€ë²ˆí˜¸ëŠ” ë°˜ë“œì‹œ BCryptë¡œ í•´ì‹œí•˜ì—¬ ì €ìž¥í•œë‹¤.
2. ë¡œê·¸ì¸ ì‹œ ID/ë¹„ë°€ë²ˆí˜¸ ê²€ì¦ í›„ ì„¸ì…˜ ë˜ëŠ” JWT í† í°ì„ ë°œê¸‰í•œë‹¤.
3. ë°œê¸‰ëœ ì¸ì¦ ì •ë³´ë¥¼ ì‚¬ìš©í•´ ë³´í˜¸ëœ APIì— ì ‘ê·¼í•œë‹¤.
4. ì—­í• (Role)ì— ë”°ë¼ ì ‘ê·¼ ê°€ëŠ¥í•œ APIê°€ ë‹¬ë¼ì§„ë‹¤.
5. ê´€ë¦¬ìžëŠ” ì¼ë°˜ ì‚¬ìš©ìžë³´ë‹¤ ë” ë†’ì€ ê¶Œí•œì„ ê°€ì§„ë‹¤.
6. ì „ì²´ ì¸ì¦Â·ì¸ê°€ ê³¼ì •ì€ Security FilterChainì„ í†µí•´ ì²˜ë¦¬ëœë‹¤.

---

## ðŸ§  ë‹¨ê³„ ìš”ì•½

| ë‹¨ê³„          | ì£¼ì œ       | í•µì‹¬ í¬ì¸íŠ¸                                              |
|-------------|----------|-----------------------------------------------------|
| SEC-1       | ì„¸ì…˜ ë¡œê·¸ì¸   | HttpSession ê¸°ë°˜ ì¸ì¦ íë¦„                                |
| SEC-2       | JWT ì¸ì¦   | AccessToken / RefreshToken ë°œê¸‰Â·ê²€ì¦                    |
| SEC-2-EXTRA | JWT ì‹¬í™”   | Refresh Flow, í† í° ê°±ì‹  ì „ëžµ                              |
| SEC-3       | í•„í„° ì²´ì¸    | FilterChain ë™ìž‘ ìˆœì„œ ë° ì»¤ìŠ¤í„°ë§ˆì´ì§•                          |
| SEC-4       | ê¶Œí•œ ì œì–´    | Role ê¸°ë°˜ ì ‘ê·¼ ì œì–´, @PreAuthorize                        |
| SEC-5       | ë¹„ë°€ë²ˆí˜¸ ì•”í˜¸í™” | BCrypt, DelegatingPasswordEncoder, upgrade-on-login |

---

## ðŸŽ¯ êµ¬í˜„ ì‹œ í™•ì¸ì‚¬í•­

- ì‚¬ìš©ìž ì—”í‹°í‹°(`User`)ì— username / password / roles í•„ë“œê°€ ì •ìƒì ìœ¼ë¡œ êµ¬ì„±ë˜ì–´ ìžˆëŠ”ì§€
- `UserRepository`ê°€ JPA ê¸°ë°˜ìœ¼ë¡œ ì˜¬ë°”ë¥´ê²Œ ë™ìž‘í•˜ëŠ”ì§€
- `CustomUserDetails`ì™€ `CustomUserDetailsService`ê°€ ì¸ì¦ ê³¼ì •ì—ì„œ ì‚¬ìš©ìž ì •ë³´ë¥¼ ì •í™•ížˆ ë°˜í™˜í•˜ëŠ”ì§€
- `SecurityConfig`ì—ì„œ `SecurityFilterChain`ê³¼ `PasswordEncoder` ì„¤ì •ì´ ì •ìƒ ì ìš©ë˜ëŠ”ì§€
- ë¡œê·¸ì¸ / íšŒì›ê°€ìž… ì»¨íŠ¸ë¡¤ëŸ¬ì˜ ìš”ì²­Â·ì‘ë‹µ íë¦„ì´ ì™„ì „í•œì§€
- ì„¸ì…˜ ë¡œê·¸ì¸ê³¼ JWT ë¡œê·¸ì¸ ë°©ì‹ ëª¨ë‘ ì¸ì¦ íë¦„ì´ ì •ìƒ ë™ìž‘í•˜ëŠ”ì§€
- Role(USER/ADMIN) ê¸°ë°˜ ì ‘ê·¼ ì œì–´ê°€ ê¸°ëŒ€í•œ ëŒ€ë¡œ ë™ìž‘í•˜ëŠ”ì§€ (`hasRole`, `@PreAuthorize`)
- ë¹„ë°€ë²ˆí˜¸ê°€ DBì— `{bcrypt}...` í˜•íƒœë¡œ í•´ì‹œ ì €ìž¥ë˜ëŠ”ì§€
- ë¡œê·¸ì¸ ì„±ê³µ ì‹œ ê¸°ì¡´ í•´ì‹œë¥¼ ìµœì‹  í•´ì‹œë¡œ ìž¬ì•”í˜¸í™”(upgrade-on-login) ê¸°ëŠ¥ì´ ì ìš©ë˜ëŠ”ì§€

---

## ðŸ“‚ í´ë” êµ¬ì¡° (ì˜ˆì‹œ)

```
06-auth-security-all-in-one/
 â”£ src/
 â”ƒ â”£ main/java/com/springlab22
 â”ƒ â”ƒ â”£ config/        â† SecurityConfig
 â”ƒ â”ƒ â”£ controller/    â† AuthController, UserController
 â”ƒ â”ƒ â”£ entity/        â† User
 â”ƒ â”ƒ â”£ repository/    â† UserRepository
 â”ƒ â”ƒ â”£ security/      â† CustomUserDetails, JwtFilter, JwtProvider
 â”ƒ â”ƒ â”— service/       â† UserService, AuthService
 â”ƒ â”— main/resources
 â”ƒ   â”£ application.yml
 â”ƒ   â”— schema.sql / data.sql (í…ŒìŠ¤íŠ¸ ë°ì´í„°)
 â”£ build.gradle
 â”£ settings.gradle
 â”— README.md
```

---

## ðŸ“Œ í•µì‹¬ í‚¤ì›Œë“œ ì •ë¦¬

- **Authentication**: ì¸ì¦ â€” ì‚¬ìš©ìž í™•ì¸ ê³¼ì •
- **Authorization**: ì¸ê°€ â€” ì ‘ê·¼ ê°€ëŠ¥ ì—¬ë¶€ íŒë‹¨
- **FilterChain**: ì¸ì¦Â·ì¸ê°€ ì²˜ë¦¬ê°€ ì´ë£¨ì–´ì§€ëŠ” í•„í„° íë¦„
- **PasswordEncoder**: BCrypt ê¸°ë°˜ ë¹„ë°€ë²ˆí˜¸ í•´ì‹œ ì²˜ë¦¬
- **JWT**: ë¬´ìƒíƒœ(stateless) ì¸ì¦ ë°©ì‹
- **RoleHierarchy**: ê¶Œí•œ ê³„ì¸µ êµ¬ì¡° (`ADMIN > USER`)   