# [DEPLOY-2단계] 질문노트: Nginx 리버스 프록시 & 방화벽 설정 (nginx)

> 💬 봄이가 직접 궁금해서 물어본 것들 + 온이의 설명 요약  
>  
> (코드: EC2 내부 Nginx 리버스 프록시 실습 기준)

---

### 💡 1. `sites-available` 과 `sites-enabled` 는 무슨 차이야?

| 질문 | 답변 요약 |
| --- | --- |
| 두 폴더가 왜 따로 존재해? | Nginx는 설정 파일을 두 단계로 관리해. `sites-available`은 “작성용(비활성)” 폴더, `sites-enabled`는 “실행 중(활성)” 폴더야. |
| 왜 굳이 두 개로 나누는 거야? | 여러 설정 파일을 관리할 때 실수로 잘못된 걸 바로 적용하지 않도록 분리해둔 구조야. 활성화는 `ln -s` 심볼릭 링크로 연결해서 제어해. |
| 활성화는 어떻게 해? | `sudo ln -s /etc/nginx/sites-available/springlab.conf /etc/nginx/sites-enabled/springlab.conf` 명령으로 링크를 만들어주면 돼. |
| 비활성화는 어떻게 해? | `sudo rm /etc/nginx/sites-enabled/springlab.conf` 명령으로 링크만 삭제하면 비활성화돼. 원본은 그대로 남아. |

---

### 💡 2. `nginx -t` 문법 테스트는 무슨 역할이야?

| 질문 | 답변 요약 |
| --- | --- |
| `nginx -t`는 실제로 뭐 하는 명령이야? | Nginx 실행 전, 설정파일(`nginx.conf` 및 include된 conf) 문법이 올바른지 검사하는 명령이야. |
| 실패하면 어떻게 돼? | 서버는 재시작되지 않고 “어느 줄이 틀렸는지”를 에러 메시지로 알려줘. 중괄호, 세미콜론, 경로 오타를 찾는 데 유용해. |
| 왜 이게 중요해? | 문법 오류가 있는 상태에서 재시작하면 웹서버가 멈출 수 있어. 실무에서는 항상 `nginx -t` → `systemctl restart nginx` 순서로 점검해. |

---

### 💡 3. `.swp` 파일은 왜 생기고 어떻게 처리해?

| 질문 | 답변 요약 |
| --- | --- |
| `.swp` 파일이 갑자기 생겼어! | Vim 편집기가 파일을 열면 자동으로 생성하는 임시 복구용 파일이야. 비정상 종료되면 남아있게 돼. |
| 그대로 두면 안 돼? | 다음에 다시 편집할 때 “다른 프로세스가 이 파일을 편집 중” 경고가 나와. 삭제하거나 복구해야 해. |
| 어떻게 해결해? | `sudo rm /etc/nginx/sites-available/.springlab.conf.swp` 로 삭제하거나, `vim -r` 로 복구 후 `:wq` 로 저장하면 돼. |

---

### 💡 4. 방화벽(UFW)은 정확히 뭐야?

| 질문 | 답변 요약 |
| --- | --- |
| 방화벽은 어떤 역할을 해? | 서버의 네트워크 출입문(포트)을 관리하는 보안 시스템이야. 22, 80, 443 같은 포트를 열거나 닫아서 접근을 제어해. |
| EC2에는 이미 보안그룹이 있는데 또 필요한 이유는? | AWS 보안그룹은 “클라우드 외부 방화벽”, UFW는 “서버 내부 방화벽”이라 서로 다른 계층을 담당해. 두 개가 함께 동작해 2중 보호가 돼. |
| `ufw status`가 inactive인데 왜 `allow`가 됐어? | 규칙은 등록됐지만 방화벽 자체가 꺼져 있었던 거야. `sudo ufw enable` 로 활성화해야 실제로 적용돼. |

---

### 💡 5. Nginx 리버스 프록시는 왜 필요한 거야?

| 질문 | 답변 요약 |
| --- | --- |
| 그냥 8080으로 바로 쓰면 안 돼? | 가능은 하지만, 외부에 8080포트를 노출하면 URL이 지저분하고 보안상 비표준이야. |
| 리버스 프록시는 무슨 역할을 해? | 클라이언트의 요청을 대신 받아 내부 서비스(Spring Boot 8080)로 전달하고, 응답을 되돌려주는 중간 게이트웨이 역할을 해. |
| 실무에서 Nginx가 꼭 필요한 이유는? | 정적 리소스 처리, 로드밸런싱, SSL(HTTPS) 적용, 포트 숨김, 캐싱 등 다양한 기능을 프록시로 통합 관리할 수 있기 때문이야. |

---

### 💡 6. `curl http://localhost` 404는 오류야?

| 질문 | 답변 요약 |
| --- | --- |
| 404가 떴는데 실패한 거 아니야? | 아니야! Nginx가 요청을 Spring Boot로 전달했기 때문에 연결은 성공한 상태야. |
| 그럼 왜 404가 나와? | Spring Boot 쪽에 `/` 경로를 처리하는 컨트롤러가 없어서야. `/hello`처럼 존재하는 경로로 호출하면 200이 뜨지. |
| 결론적으로 상태가 어떤 거야? | Nginx ↔ Spring 연결은 완벽히 성공, 단지 Spring 라우팅 미구현일 뿐이야. |

---

### 🌱 정리 키워드

- `sites-available` / `sites-enabled` 구조  
- `ln -s` 심볼릭 링크  
- `nginx -t` 문법 검사 → restart 순서  
- `.swp` 임시 파일 / 복구 / 삭제  
- 방화벽(UFW) 개념 및 enable 필요성  
- AWS 보안 그룹 vs UFW 내부 방화벽  
- 리버스 프록시의 역할 (포트 숨김, 트래픽 중계)  
- 404 = 연결 성공 / 라우팅 없음  
